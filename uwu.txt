Ponle el mismo estilo de formulario de vehiculos a operadores, el mismo funcionamiento y estilo
para la carga y visualización de fotografías y de estructura en general, dame los codigos completos.

{{-- resources/views/vehiculos/create.blade.php — Versión Tabler (con íconos y estilo ejecutivo) --}}
<x-app-layout>
    {{-- ===== HEADER ===== --}}
    <x-slot name="header">
        <div class="page-header d-print-none">
            <div class="container-xl">
                <div class="row g-2 align-items-center">
                    <div class="col">
                        <h2 class="page-title mb-0 d-flex align-items-center gap-2">
                            Agregar Vehículo
                        </h2>
                    </div>
                    <div class="col-auto ms-auto">
                        <a href="{{ route('vehiculos.index') }}" class="btn btn-outline-dark">
                            <i class="ti ti-arrow-left me-1"></i>
                            Volver al listado
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </x-slot>

    <div class="page-body">
        <div class="container-xl">
            <form method="POST" action="{{ route('vehiculos.store') }}" novalidate enctype="multipart/form-data">
                @csrf

                {{-- Alertas --}}
                @if ($errors->any())
                    <div class="alert alert-danger" role="alert">
                        <i class="ti ti-alert-triangle me-2"></i>
                        Revisa los campos marcados y vuelve a intentar.
                    </div>
                @endif

                {{-- ===== Card: Datos del vehículo ===== --}}
                <div class="card">
                    <div class="card-header justify-content-between">
                        <h3 class="card-title d-flex align-items-center gap-2 mb-0">
                            <i class="ti ti-car"></i>
                            Datos del vehículo
                        </h3>
                    </div>

                    <div class="card-body">
                        <div class="row g-3">
                            {{-- Ubicación --}}
                            <div class="col-12 col-md-6">
                                <label for="ubicacion" class="form-label">Ubicación <span class="text-danger">*</span></label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-map-pin"></i>
                                    </span>
                                    <select id="ubicacion" name="ubicacion" class="form-select @error('ubicacion') is-invalid @enderror" required>
                                        <option value="">-- Selecciona ubicación --</option>
                                        <option value="CVC" @selected(old('ubicacion')=='CVC')>Cuernavaca</option>
                                        <option value="IXT" @selected(old('ubicacion')=='IXT')>Ixtapaluca</option>
                                        <option value="QRO" @selected(old('ubicacion')=='QRO')>Querétaro</option>
                                        <option value="VALL" @selected(old('ubicacion')=='VALL')>Vallejo</option>
                                        <option value="GDL" @selected(old('ubicacion')=='GDL')>Guadalajara</option>
                                    </select>
                                </div>
                                @error('ubicacion') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Propietario --}}
                            <div class="col-12 col-md-6">
                                <label for="propietario" class="form-label">Propietario <span class="text-danger">*</span></label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-user"></i>
                                    </span>
                                    <input id="propietario" type="text" name="propietario" value="{{ old('propietario') }}" class="form-control @error('propietario') is-invalid @enderror" required placeholder="Nombre del propietario">
                                </div>
                                @error('propietario') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Unidad --}}
                            <div class="col-12 col-md-6">
                                <label for="unidad" class="form-label">Unidad <span class="text-danger">*</span></label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-truck"></i>
                                    </span>
                                    <input id="unidad" type="text" name="unidad" value="{{ old('unidad') }}" class="form-control @error('unidad') is-invalid @enderror" required placeholder="Ej. U-012">
                                </div>
                                @error('unidad') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Serie (VIN) --}}
                            <div class="col-12 col-md-6">
                                <label for="serie" class="form-label">Serie (VIN) <span class="text-danger">*</span></label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-barcode"></i>
                                    </span>
                                    <input id="serie" type="text" name="serie" value="{{ old('serie') }}" class="form-control @error('serie') is-invalid @enderror" required aria-describedby="serie_help" placeholder="Número de serie completo">
                                </div>
                                <div id="serie_help" class="form-hint">Usa el número de serie completo registrado en la tarjeta.</div>
                                @error('serie') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Marca --}}
                            <div class="col-12 col-md-6">
                                <label for="marca" class="form-label">Marca</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-badge"></i>
                                    </span>
                                    <input id="marca" type="text" name="marca" value="{{ old('marca') }}" class="form-control @error('marca') is-invalid @enderror" placeholder="Ej. Nissan, Toyota…">
                                </div>
                                @error('marca') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Año --}}
                            <div class="col-12 col-md-6">
                                <label for="anio" class="form-label">Año</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-calendar-stats"></i>
                                    </span>
                                    <input id="anio" type="number" name="anio" min="1900" max="{{ date('Y') + 1 }}" value="{{ old('anio') }}" class="form-control @error('anio') is-invalid @enderror" placeholder="{{ date('Y') }}">
                                </div>
                                @error('anio') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Motor --}}
                            <div class="col-12 col-md-6">
                                <label for="motor" class="form-label">Motor</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-engine"></i>
                                    </span>
                                    <input id="motor" type="text" name="motor" value="{{ old('motor') }}" class="form-control @error('motor') is-invalid @enderror" placeholder="Ej. 2.5 L / Diesel">
                                </div>
                                @error('motor') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Placa --}}
                            <div class="col-12 col-md-6">
                                <label for="placa" class="form-label">Placa</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-license"></i>
                                    </span>
                                    <input id="placa" type="text" name="placa" value="{{ old('placa') }}" class="form-control @error('placa') is-invalid @enderror" placeholder="ABC-123-4">
                                </div>
                                @error('placa') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Estado --}}
                            <div class="col-12 col-md-6">
                                <label for="estado" class="form-label">Estado</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-map"></i>
                                    </span>
                                    <input id="estado" type="text" name="estado" value="{{ old('estado') }}" class="form-control @error('estado') is-invalid @enderror" placeholder="Entidad federativa">
                                </div>
                                @error('estado') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Tarjeta SiVale --}}
                            <div class="col-12">
                                <label for="tarjeta_si_vale_id" class="form-label">Tarjeta SiVale</label>
                                <div class="input-icon">
                                    <select id="tarjeta_si_vale_id" name="tarjeta_si_vale_id" class="form-select @error('tarjeta_si_vale_id') is-invalid @enderror" aria-describedby="sivale_help">
                                        <option value="">-- Sin tarjeta asignada --</option>
                                        @foreach($tarjetas as $tarjeta)
                                            <option value="{{ $tarjeta->id }}" @selected(old('tarjeta_si_vale_id') == $tarjeta->id)>{{ $tarjeta->numero_tarjeta }}</option>
                                        @endforeach
                                    </select>
                                </div>
                                <div id="sivale_help" class="form-hint">Asigna una tarjeta válida en caso de corresponder.</div>
                                @error('tarjeta_si_vale_id') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Vencimiento tarjeta de circulación --}}
                            <div class="col-12 col-md-6">
                                <label for="vencimiento_t_circulacion" class="form-label">Vencimiento tarjeta de circulación</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-calendar-event"></i>
                                    </span>
                                    <input id="vencimiento_t_circulacion" type="date" name="vencimiento_t_circulacion" value="{{ old('vencimiento_t_circulacion') }}" class="form-control @error('vencimiento_t_circulacion') is-invalid @enderror">
                                </div>
                                @error('vencimiento_t_circulacion') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Cambio de placas --}}
                            <div class="col-12 col-md-6">
                                <label for="cambio_placas" class="form-label">Cambio de placas</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-calendar-event"></i>
                                    </span>
                                    <input id="cambio_placas" type="date" name="cambio_placas" value="{{ old('cambio_placas') }}" class="form-control @error('cambio_placas') is-invalid @enderror">
                                </div>
                                @error('cambio_placas') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Póliza HDI --}}
                            <div class="col-12 col-md-6">
                                <label for="poliza_hdi" class="form-label">Póliza HDI</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-shield"></i>
                                    </span>
                                    <input id="poliza_hdi" type="text" name="poliza_hdi" value="{{ old('poliza_hdi') }}" class="form-control @error('poliza_hdi') is-invalid @enderror" placeholder="Número de póliza">
                                </div>
                                @error('poliza_hdi') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Póliza Latino --}}
                            <div class="col-12 col-md-6">
                                <label for="poliza_latino" class="form-label">Póliza Latino</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-shield-plus"></i>
                                    </span>
                                    <input id="poliza_latino" type="text" name="poliza_latino" value="{{ old('poliza_latino') }}" class="form-control @error('poliza_latino') is-invalid @enderror" placeholder="Número de póliza">
                                </div>
                                @error('poliza_latino') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Póliza Qualitas --}}
                            <div class="col-12 col-md-6">
                                <label for="poliza_qualitas" class="form-label">Póliza Qualitas</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon">
                                        <i class="ti ti-shield-lock"></i>
                                    </span>
                                    <input id="poliza_qualitas" type="text" name="poliza_qualitas" value="{{ old('poliza_qualitas') }}" class="form-control @error('poliza_qualitas') is-invalid @enderror" placeholder="Número de póliza">
                                </div>
                                @error('poliza_qualitas') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>
                        </div>
                    </div>

                    {{-- Fotos (opcional) --}}
                    <div class="card-body border-top">
                        <h3 class="card-title d-flex align-items-center gap-2">
                            <i class="ti ti-photo"></i>
                            Fotografías
                        </h3>
                        <div class="form-hint mb-2">Máx 8MB c/u.</div>
                        <div class="input-group">
                            <span class="input-group-text"><i class="ti ti-upload"></i></span>
                            <input type="file" name="fotos[]" accept="image/*" multiple class="form-control @error('fotos') is-invalid @enderror @error('fotos.*') is-invalid @enderror">
                        </div>
                        @error('fotos')   <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                        @error('fotos.*') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                    </div>

                    {{-- Footer acciones --}}
                    <div class="card-footer d-flex justify-content-end gap-2">
                        <a href="{{ url()->previous() ?: route('vehiculos.index') }}" class="btn btn-outline-dark">
                            <i class="ti ti-x me-1"></i>
                            Cancelar
                        </a>
                        <button type="submit" class="btn btn-danger">
                            <i class="ti ti-device-floppy me-1"></i>
                            Guardar
                        </button>
                    </div>
                </div>
            </form>

            {{-- FOOTER --}}
            <div class="text-center text-secondary small py-4">
                © {{ date('Y') }} Futurama Tires · Todos los derechos reservados
            </div>
        </div>
    </div>
</x-app-layout>

{{-- resources/views/vehiculos/edit.blade.php --}}
<x-app-layout>
    {{-- ===== HEADER ===== --}}
    <x-slot name="header">
        <div class="page-header d-print-none">
            <div class="container-xl">
                <div class="row g-2 align-items-center">
                    <div class="col">
                        <h2 class="page-title mb-0 d-flex align-items-center gap-2">
                            Editar Vehículo
                        </h2>
                    </div>
                    <div class="col-auto ms-auto d-flex gap-2">
                        <a href="{{ route('vehiculos.tanques.index', $vehiculo) }}" class="btn btn-warning">
                            <i class="ti ti-gas-station me-1"></i>
                            Tanques de combustible
                        </a>
                        <a href="{{ route('vehiculos.index') }}" class="btn btn-outline-dark">
                            <i class="ti ti-arrow-left me-1"></i>
                            Volver al listado
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </x-slot>

    <div class="page-body">
        <div class="container-xl">

            {{-- ===== FORM PRINCIPAL (UPDATE) =====
                 NOTA: Este formulario ahora también envuelve la sección de "Fotografías actuales"
                 para que los checkboxes de eliminación viajen en el mismo submit. --}}
            <form id="vehiculo-form" method="POST" action="{{ route('vehiculos.update', $vehiculo) }}" novalidate enctype="multipart/form-data">
                @csrf
                @method('PUT')

                {{-- Alertas --}}
                @if ($errors->any())
                    <div class="alert alert-danger" role="alert">
                        <i class="ti ti-alert-triangle me-2"></i>
                        Revisa los campos marcados y vuelve a intentar.
                    </div>
                @endif
                @error('general')
                    <div class="alert alert-danger" role="alert">
                        <i class="ti ti-alert-triangle me-2"></i>{{ $message }}
                    </div>
                @enderror

                <div class="card">
                    <div class="card-header justify-content-between">
                        <h3 class="card-title d-flex align-items-center gap-2 mb-0">
                            <i class="ti ti-car"></i>
                            Datos del vehículo
                        </h3>
                    </div>

                    <div class="card-body">
                        <div class="row g-3">
                            {{-- Ubicación --}}
                            <div class="col-12 col-md-6">
                                <label for="ubicacion" class="form-label">Ubicación <span class="text-danger">*</span></label>
                                <div class="input-icon">
                                    <select id="ubicacion" name="ubicacion" class="form-select @error('ubicacion') is-invalid @enderror" required>
                                        <option value="">-- Selecciona ubicación --</option>
                                        <option value="CVC" @selected(old('ubicacion', $vehiculo->ubicacion ?? '')=='CVC')>Cuernavaca</option>
                                        <option value="IXT" @selected(old('ubicacion', $vehiculo->ubicacion ?? '')=='IXT')>Ixtapaluca</option>
                                        <option value="QRO" @selected(old('ubicacion', $vehiculo->ubicacion ?? '')=='QRO')>Querétaro</option>
                                        <option value="VALL" @selected(old('ubicacion', $vehiculo->ubicacion ?? '')=='VALL')>Vallejo</option>
                                        <option value="GDL" @selected(old('ubicacion', $vehiculo->ubicacion ?? '')=='GDL')>Guadalajara</option>
                                    </select>
                                </div>
                                @error('ubicacion') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Propietario --}}
                            <div class="col-12 col-md-6">
                                <label for="propietario" class="form-label">Propietario <span class="text-danger">*</span></label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-user"></i></span>
                                    <input id="propietario" type="text" name="propietario" value="{{ old('propietario', $vehiculo->propietario ?? '') }}" class="form-control @error('propietario') is-invalid @enderror" required placeholder="Nombre del propietario">
                                </div>
                                @error('propietario') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Unidad --}}
                            <div class="col-12 col-md-6">
                                <label for="unidad" class="form-label">Unidad <span class="text-danger">*</span></label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-truck"></i></span>
                                    <input id="unidad" type="text" name="unidad" value="{{ old('unidad', $vehiculo->unidad ?? '') }}" class="form-control @error('unidad') is-invalid @enderror" required placeholder="Ej. U-012">
                                </div>
                                @error('unidad') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Serie (VIN) --}}
                            <div class="col-12 col-md-6">
                                <label for="serie" class="form-label">Serie (VIN) <span class="text-danger">*</span></label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-barcode"></i></span>
                                    <input id="serie" type="text" name="serie" value="{{ old('serie', $vehiculo->serie ?? '') }}" class="form-control @error('serie') is-invalid @enderror" required aria-describedby="serie_help" placeholder="Número de serie completo">
                                </div>
                                <div id="serie_help" class="form-hint">Usa el número de serie completo registrado en la tarjeta.</div>
                                @error('serie') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Marca --}}
                            <div class="col-12 col-md-6">
                                <label for="marca" class="form-label">Marca</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-badge"></i></span>
                                    <input id="marca" type="text" name="marca" value="{{ old('marca', $vehiculo->marca ?? '') }}" class="form-control @error('marca') is-invalid @enderror" placeholder="Ej. Nissan, Toyota…">
                                </div>
                                @error('marca') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Año --}}
                            <div class="col-12 col-md-6">
                                <label for="anio" class="form-label">Año</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-calendar-stats"></i></span>
                                    <input id="anio" type="number" name="anio" min="1900" max="{{ date('Y') + 1 }}" value="{{ old('anio', $vehiculo->anio ?? '') }}" class="form-control @error('anio') is-invalid @enderror" placeholder="{{ date('Y') }}">
                                </div>
                                @error('anio') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Motor --}}
                            <div class="col-12 col-md-6">
                                <label for="motor" class="form-label">Motor</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-engine"></i></span>
                                    <input id="motor" type="text" name="motor" value="{{ old('motor', $vehiculo->motor ?? '') }}" class="form-control @error('motor') is-invalid @enderror" placeholder="Ej. 2.5 L / Diesel">
                                </div>
                                @error('motor') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Placa --}}
                            <div class="col-12 col-md-6">
                                <label for="placa" class="form-label">Placa</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-license"></i></span>
                                    <input id="placa" type="text" name="placa" value="{{ old('placa', $vehiculo->placa ?? '') }}" class="form-control @error('placa') is-invalid @enderror" placeholder="ABC-123-4">
                                </div>
                                @error('placa') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Estado --}}
                            <div class="col-12 col-md-6">
                                <label for="estado" class="form-label">Estado</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-map"></i></span>
                                    <input id="estado" type="text" name="estado" value="{{ old('estado', $vehiculo->estado ?? '') }}" class="form-control @error('estado') is-invalid @enderror" placeholder="Entidad federativa">
                                </div>
                                @error('estado') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Tarjeta SiVale --}}
                            <div class="col-12">
                                <label for="tarjeta_si_vale_id" class="form-label">Tarjeta SiVale</label>
                                <div class="input-icon">
                                    <select id="tarjeta_si_vale_id" name="tarjeta_si_vale_id" class="form-select @error('tarjeta_si_vale_id') is-invalid @enderror" aria-describedby="sivale_help">
                                        <option value="">-- Sin tarjeta asignada --</option>
                                        @foreach($tarjetas as $tarjeta)
                                            <option value="{{ $tarjeta->id }}" @selected(old('tarjeta_si_vale_id', $vehiculo->tarjeta_si_vale_id ?? '')==$tarjeta->id)>
                                                {{ $tarjeta->numero_tarjeta }}
                                            </option>
                                        @endforeach
                                    </select>
                                </div>
                                <div id="sivale_help" class="form-hint">Selecciona una tarjeta vigente, si aplica.</div>
                                @error('tarjeta_si_vale_id') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Vencimiento tarjeta de circulación --}}
                            <div class="col-12 col-md-6">
                                <label for="vencimiento_t_circulacion" class="form-label">Vencimiento tarjeta de circulación</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-calendar-event"></i></span>
                                    <input id="vencimiento_t_circulacion" type="date" name="vencimiento_t_circulacion" value="{{ old('vencimiento_t_circulacion', $vehiculo->vencimiento_t_circulacion ?? '') }}" class="form-control @error('vencimiento_t_circulacion') is-invalid @enderror">
                                </div>
                                @error('vencimiento_t_circulacion') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Cambio de placas --}}
                            <div class="col-12 col-md-6">
                                <label for="cambio_placas" class="form-label">Cambio de placas</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-calendar-event"></i></span>
                                    <input id="cambio_placas" type="date" name="cambio_placas" value="{{ old('cambio_placas', $vehiculo->cambio_placas ?? '') }}" class="form-control @error('cambio_placas') is-invalid @enderror">
                                </div>
                                @error('cambio_placas') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            {{-- Pólizas --}}
                            <div class="col-12 col-md-6">
                                <label for="poliza_hdi" class="form-label">Póliza HDI</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-shield-check"></i></span>
                                    <input id="poliza_hdi" type="text" name="poliza_hdi" value="{{ old('poliza_hdi', $vehiculo->poliza_hdi ?? '') }}" class="form-control @error('poliza_hdi') is-invalid @enderror" placeholder="Número de póliza">
                                </div>
                                @error('poliza_hdi') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            <div class="col-12 col-md-6">
                                <label for="poliza_latino" class="form-label">Póliza Latino</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-shield-plus"></i></span>
                                    <input id="poliza_latino" type="text" name="poliza_latino" value="{{ old('poliza_latino', $vehiculo->poliza_latino ?? '') }}" class="form-control @error('poliza_latino') is-invalid @enderror" placeholder="Número de póliza">
                                </div>
                                @error('poliza_latino') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>

                            <div class="col-12 col-md-6">
                                <label for="poliza_qualitas" class="form-label">Póliza Qualitas</label>
                                <div class="input-icon">
                                    <span class="input-icon-addon"><i class="ti ti-shield-lock"></i></span>
                                    <input id="poliza_qualitas" type="text" name="poliza_qualitas" value="{{ old('poliza_qualitas', $vehiculo->poliza_qualitas ?? '') }}" class="form-control @error('poliza_qualitas') is-invalid @enderror" placeholder="Número de póliza">
                                </div>
                                @error('poliza_qualitas') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                            </div>
                        </div>
                    </div>

                    {{-- Subir nuevas fotos --}}
                    <div class="card-body border-top">
                        <h3 class="card-title d-flex align-items-center gap-2">
                            <i class="ti ti-photo-plus"></i>
                            Agregar fotografías
                        </h3>
                        <div class="form-hint mb-2">Máx 8MB c/u.</div>
                        <div class="input-group">
                            <span class="input-group-text"><i class="ti ti-upload"></i></span>
                            <input type="file" name="fotos[]" accept="image/*" multiple class="form-control @error('fotos') is-invalid @enderror @error('fotos.*') is-invalid @enderror">
                        </div>
                        @error('fotos')   <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                        @error('fotos.*') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                    </div>

                    {{-- ===== FOTOS ACTUALES (DENTRO DEL MISMO FORM) ===== --}}
                    <div class="card-body border-top">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <h3 class="card-title d-flex align-items-center gap-2 mb-0">
                                <i class="ti ti-photo"></i>
                                Fotografías actuales
                            </h3>
                            <div class="d-flex align-items-center gap-2">
                                <span class="badge bg-secondary-lt">
                                    {{ $vehiculo->fotos->count() }} foto(s)
                                </span>
                                <span id="marcadasBadge" class="badge bg-red-lt d-none">
                                    0 seleccionadas
                                </span>
                                <div class="btn-group">
                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnSelectAll">
                                        <i class="ti ti-checkbox me-1"></i>Seleccionar todo
                                    </button>
                                    <button type="button" class="btn btn-outline-secondary btn-sm" id="btnClearAll">
                                        <i class="ti ti-square-off me-1"></i>Limpiar
                                    </button>
                                </div>
                            </div>
                        </div>

                        @if($vehiculo->fotos->isEmpty())
                            <div class="empty">
                                <div class="empty-icon"><i class="ti ti-photo-off"></i></div>
                                <p class="empty-title">Este vehículo aún no tiene fotografías</p>
                            </div>
                        @else
                            @php
                                $oldEliminar = collect(old('fotos_eliminar', []))->map(fn($v)=> (int)$v)->all();
                            @endphp

                            <div class="row g-2">
                                @foreach($vehiculo->fotos as $foto)
                                    @php $checked = in_array($foto->id, $oldEliminar, true); @endphp
                                    <div class="col-6 col-sm-4 col-md-3">
                                        <div class="card photo-card h-100 position-relative {{ $checked ? 'is-selected' : '' }}">
                                            <a href="{{ route('vehiculos.fotos.show', $foto) }}"
                                               target="_blank" rel="noopener noreferrer" title="Abrir en nueva pestaña" class="d-block">
                                                <div class="img-responsive img-responsive-4x3 card-img-top"
                                                     style="background-image: url('{{ route('vehiculos.fotos.show', $foto) }}')"></div>
                                            </a>

                                            <div class="card-body py-2">
                                                <label class="form-check m-0 w-100 d-flex align-items-center gap-2">
                                                    <input class="form-check-input foto-check" type="checkbox"
                                                           name="fotos_eliminar[]"
                                                           value="{{ $foto->id }}"
                                                           @checked($checked)
                                                           data-photo-card
                                                    >
                                                    <span class="form-check-label small text-danger fw-semibold">
                                                        Marcar para eliminar al guardar
                                                    </span>
                                                </label>
                                            </div>

                                            {{-- Overlay de selección (visual) --}}
                                            <div class="photo-overlay-check">
                                                <i class="ti ti-check"></i>
                                            </div>
                                        </div>
                                    </div>
                                @endforeach
                            </div>

                            <div class="mt-2 text-secondary small d-none d-md-block">
                                <i class="ti ti-info-circle me-1"></i>
                                Tip: puedes abrir la imagen en una nueva pestaña y marcar la casilla para eliminarla. Todo se aplica al presionar <b>Guardar cambios</b>.
                            </div>
                        @endif
                    </div>

                    {{-- Footer acciones --}}
                    <div class="card-footer d-flex justify-content-end gap-2">
                        <a href="{{ url()->previous() ?: route('vehiculos.index') }}" class="btn btn-outline-dark">
                            <i class="ti ti-x me-1"></i> Cancelar
                        </a>
                        <button type="submit" form="vehiculo-form" class="btn btn-danger">
                            <i class="ti ti-device-floppy me-1"></i> Guardar cambios
                        </button>
                    </div>
                </div>
            </form>

            {{-- FOOTER --}}
            <div class="text-center text-secondary small py-4">
                © {{ date('Y') }} Futurama Tires · Todos los derechos reservados
            </div>
        </div>
    </div>

    <style>
        /* Tarjeta de foto con overlay cuando está seleccionada */
        .photo-card {
            transition: transform .12s ease, box-shadow .12s ease;
        }
        .photo-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 18px rgba(0,0,0,.08);
        }
        .photo-card.is-selected {
            outline: 2px solid var(--tblr-red, #f03e3e);
            outline-offset: 0;
        }
        .photo-overlay-check {
            position: absolute;
            inset: .5rem .5rem auto auto;
            width: 1.75rem;
            height: 1.75rem;
            border-radius: 50%;
            background: rgba(240,62,62,.95); /* rojo */
            color: #fff;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(0,0,0,.2);
        }
        .photo-card.is-selected .photo-overlay-check {
            display: flex;
        }
    </style>

    <script>
        (function () {
            const checks = Array.from(document.querySelectorAll('.foto-check'));
            const badge  = document.getElementById('marcadasBadge');
            const btnAll = document.getElementById('btnSelectAll');
            const btnClr = document.getElementById('btnClearAll');

            function syncCardState(input) {
                const card = input.closest('.photo-card');
                if (!card) return;
                card.classList.toggle('is-selected', input.checked);
            }

            function refreshBadge() {
                const total = checks.filter(ch => ch.checked).length;
                if (total > 0) {
                    badge.textContent = `${total} seleccionadas`;
                    badge.classList.remove('d-none');
                } else {
                    badge.classList.add('d-none');
                }
            }

            checks.forEach(ch => {
                // estado inicial (por si viene del old())
                syncCardState(ch);
                ch.addEventListener('change', () => {
                    syncCardState(ch);
                    refreshBadge();
                });
            });

            if (btnAll) {
                btnAll.addEventListener('click', () => {
                    checks.forEach(ch => ch.checked = true);
                    checks.forEach(syncCardState);
                    refreshBadge();
                });
            }
            if (btnClr) {
                btnClr.addEventListener('click', () => {
                    checks.forEach(ch => ch.checked = false);
                    checks.forEach(syncCardState);
                    refreshBadge();
                });
            }

            // pinta badge al cargar
            refreshBadge();
        })();
    </script>
</x-app-layout>

{{-- resources/views/operadores/create.blade.php — campos ordenados lógicamente y accesibles --}}
<x-app-layout>
    {{-- HEADER --}}
    <x-slot name="header">
        <div class="page-header d-print-none">
            <div class="container-xl">
                <div class="row g-2 align-items-center">
                    <div class="col">
                        <p class="text-secondary text-uppercase small mb-1">Operadores</p>
                        <h2 class="page-title mb-0">Registrar un nuevo Operador</h2>
                    </div>
                    <div class="col-auto ms-auto">
                        <a href="{{ route('operadores.index') }}" class="btn btn-outline-dark">
                            <span class="material-symbols-outlined me-1 align-middle">arrow_back</span> Volver al listado
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </x-slot>

    <div class="page-body">
        <div class="container-xl">

            {{-- FLASH ÉXITO --}}
            @if(session('success'))
                <div class="alert alert-success mb-4" role="alert">
                    <span class="material-symbols-outlined me-2 align-middle">check_circle</span>{{ session('success') }}
                </div>
            @endif

            {{-- ERRORES --}}
            @if ($errors->any())
                <div class="alert alert-danger mb-4" role="alert">
                    <span class="material-symbols-outlined me-2 align-middle">warning</span>Revisa los campos marcados y vuelve a intentar.
                    @if($errors->count() > 0)
                        <ul class="mt-2 mb-0 ps-4">
                            @foreach ($errors->all() as $error)
                                <li class="small">{{ $error }}</li>
                            @endforeach
                        </ul>
                    @endif
                </div>
            @endif

            {{-- ===== FORM ÚNICO (abarca ambas columnas) ===== --}}
            <form id="operador-form" method="POST" action="{{ route('operadores.store') }}" enctype="multipart/form-data" novalidate>
                @csrf

                <div class="row g-4">
                    {{-- ===== COLUMNA IZQUIERDA: DATOS ===== --}}
                    <div class="col-12 col-xl-8">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title mb-0 d-flex align-items-center gap-2">
                                    <span class="material-symbols-outlined">badge</span> Datos del operador
                                </h3>
                            </div>

                            <div class="card-body pt-3">
                                <div class="row g-4">

                                    {{-- ================= 1) IDENTIDAD ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mb-2">Identidad</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="nombre" class="form-label">Nombre <span class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">person</span></span>
                                                    <input id="nombre" name="nombre" type="text" autocomplete="given-name"
                                                           class="form-control @error('nombre') is-invalid @enderror"
                                                           value="{{ old('nombre') }}" required placeholder="Ej. Juan">
                                                    @error('nombre') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="apellido_paterno" class="form-label">Apellido paterno <span class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">person</span></span>
                                                    <input id="apellido_paterno" name="apellido_paterno" type="text" autocomplete="family-name"
                                                           class="form-control @error('apellido_paterno') is-invalid @enderror"
                                                           value="{{ old('apellido_paterno') }}" required placeholder="Ej. Pérez">
                                                    @error('apellido_paterno') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="apellido_materno" class="form-label">Apellido materno</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">account_circle</span></span>
                                                    <input id="apellido_materno" name="apellido_materno" type="text" autocomplete="additional-name"
                                                           class="form-control @error('apellido_materno') is-invalid @enderror"
                                                           value="{{ old('apellido_materno') }}" placeholder="(opcional)">
                                                    @error('apellido_materno') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {{-- ================= 2) CONTACTO BÁSICO ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mt-2 mb-2">Contacto básico</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="email" class="form-label">Correo electrónico <span class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">mail</span></span>
                                                    <input id="email" name="email" type="email" autocomplete="email"
                                                           class="form-control @error('email') is-invalid @enderror"
                                                           value="{{ old('email') }}" required
                                                           placeholder="usuario@dominio.com" aria-describedby="email_help">
                                                    @error('email') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                                <div id="email_help" class="form-hint">Usa un correo válido al que el operador tenga acceso.</div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="telefono" class="form-label">Teléfono (10 dígitos)</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">call</span></span>
                                                    <input id="telefono" name="telefono" type="tel"
                                                           inputmode="numeric" maxlength="10" pattern="[0-9]{10}"
                                                           oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)"
                                                           autocomplete="tel"
                                                           class="form-control @error('telefono') is-invalid @enderror"
                                                           value="{{ old('telefono') }}" placeholder="Ej. 7771234567"
                                                           title="Ingresa exactamente 10 dígitos (solo números)">
                                                    @error('telefono') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            {{-- ===== NUEVO: DOMICILIO ===== --}}
                                            <div class="col-12">
                                                <label for="domicilio" class="form-label">Domicilio</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">home_pin</span></span>
                                                    <input id="domicilio" name="domicilio" type="text"
                                                           class="form-control @error('domicilio') is-invalid @enderror"
                                                           value="{{ old('domicilio') }}"
                                                           placeholder="Calle, número, colonia, ciudad, estado, C.P.">
                                                    @error('domicilio') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {{-- ================= 3) DATOS PERSONALES ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mt-2 mb-2">Datos personales</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="estado_civil" class="form-label">Estado civil</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <span class="material-symbols-outlined">diversity_3</span>
                                                    </span>
                                                    <select id="estado_civil" name="estado_civil"
                                                            class="form-select @error('estado_civil') is-invalid @enderror">
                                                        <option value="">(sin especificar)</option>
                                                        @foreach(['soltero'=>'Soltero','casado'=>'Casado','viudo'=>'Viudo','divorciado'=>'Divorciado','union libre'=>'Union libre'] as $val=>$label)
                                                            <option value="{{ $val }}" {{ old('estado_civil')===$val ? 'selected' : '' }}>{{ $label }}</option>
                                                        @endforeach
                                                    </select>
                                                    @error('estado_civil') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="tipo_sangre" class="form-label">Tipo de sangre</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">bloodtype</span></span>
                                                    <input id="tipo_sangre" name="tipo_sangre" type="text"
                                                           class="form-control @error('tipo_sangre') is-invalid @enderror"
                                                           value="{{ old('tipo_sangre') }}" placeholder="Ej. O+, A-, B+" maxlength="5">
                                                    @error('tipo_sangre') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                                <div class="form-hint">Formato corto (ej.: O+, A-, AB-).</div>
                                            </div>
                                        </div>
                                    </div>

                                    {{-- ================= 4) IDENTIFICADORES OFICIALES ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mt-2 mb-2">Identificadores oficiales</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="curp" class="form-label">CURP</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">badge</span></span>
                                                    <input id="curp" name="curp" type="text"
                                                           class="form-control @error('curp') is-invalid @enderror"
                                                           value="{{ old('curp') }}" maxlength="18"
                                                           style="text-transform:uppercase"
                                                           oninput="this.value=this.value.toUpperCase().replace(/\s+/g,'');"
                                                           pattern="[A-ZÑ0-9]{18}"
                                                           title="18 caracteres en mayúsculas (A-Z/Ñ/0-9)">
                                                    @error('curp') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="rfc" class="form-label">RFC</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">verified</span></span>
                                                    <input id="rfc" name="rfc" type="text"
                                                           class="form-control @error('rfc') is-invalid @enderror"
                                                           value="{{ old('rfc') }}" maxlength="13"
                                                           style="text-transform:uppercase"
                                                           oninput="this.value=this.value.toUpperCase().replace(/\s+/g,'');"
                                                           pattern="([A-ZÑ&]{3,4})\d{6}[A-Z0-9]{3}"
                                                           title="3-4 letras + 6 dígitos de fecha + 3 alfanum.">
                                                    @error('rfc') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {{-- ================= 5) CONTACTO DE EMERGENCIA ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mt-2 mb-2">Contacto de emergencia</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="contacto_emergencia_nombre" class="form-label">Nombre</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">contact_emergency</span></span>
                                                    <input id="contacto_emergencia_nombre" name="contacto_emergencia_nombre" type="text"
                                                           class="form-control @error('contacto_emergencia_nombre') is-invalid @enderror"
                                                           value="{{ old('contacto_emergencia_nombre') }}" placeholder="Ej. Juan Pérez">
                                                    @error('contacto_emergencia_nombre') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="contacto_emergencia_parentesco" class="form-label">Parentesco</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">diversity_1</span></span>
                                                    <input id="contacto_emergencia_parentesco" name="contacto_emergencia_parentesco" type="text"
                                                           class="form-control @error('contacto_emergencia_parentesco') is-invalid @enderror"
                                                           value="{{ old('contacto_emergencia_parentesco') }}" placeholder="Ej. Esposa, Hermano, Amigo">
                                                    @error('contacto_emergencia_parentesco') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="contacto_emergencia_tel" class="form-label">Teléfono de emergencia (10 dígitos)</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">call</span></span>
                                                    <input id="contacto_emergencia_tel" name="contacto_emergencia_tel" type="tel"
                                                           inputmode="numeric" maxlength="10" pattern="[0-9]{10}"
                                                           oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)"
                                                           class="form-control @error('contacto_emergencia_tel') is-invalid @enderror"
                                                           value="{{ old('contacto_emergencia_tel') }}" placeholder="Ej. 7770000000"
                                                           title="Ingresa exactamente 10 dígitos (solo números)">
                                                    @error('contacto_emergencia_tel') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="contacto_emergencia_ubicacion" class="form-label">Ubicación</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">place</span></span>
                                                    <input id="contacto_emergencia_ubicacion" name="contacto_emergencia_ubicacion" type="text"
                                                           class="form-control @error('contacto_emergencia_ubicacion') is-invalid @enderror"
                                                           value="{{ old('contacto_emergencia_ubicacion') }}" placeholder="Ej. Cuernavaca, Morelos">
                                                    @error('contacto_emergencia_ubicacion') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div> {{-- /row --}}
                            </div>
                        </div>
                    </div>

                    {{-- ===== COLUMNA DERECHA: AVATAR + FOTOS ===== --}}
                    <div class="col-12 col-xl-4">

                        {{-- FOTOS: subir + previsualizar --}}
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title mb-0 d-flex align-items-center gap-2">
                                    <span class="material-symbols-outlined">add_photo_alternate</span> Agregar fotografías
                                </h3>
                            </div>

                            <div class="card-body">
                                <div class="form-hint mb-3">Máx 5&nbsp;MB por archivo.</div>

                                <div class="row g-3 align-items-end">
                                    <div class="col-12">
                                        <div class="input-group">
                                            <span class="input-group-text"><span class="material-symbols-outlined">upload</span></span>
                                            <input type="file" id="fotos" name="fotos[]" accept="image/*" multiple
                                                   class="form-control @error('fotos') is-invalid @enderror @error('fotos.*') is-invalid @enderror"
                                                   aria-describedby="fotos_help">
                                        </div>
                                        @error('fotos')   <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                                        @error('fotos.*') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                                    </div>
                                </div>

                                {{-- Controles y contador --}}
                                <div class="d-flex justify-content-between align-items-center my-3">
                                    <div class="text-secondary small">
                                        <span id="fotos-count">0</span> seleccionada(s)
                                    </div>
                                    <div class="btn-group">
                                        <button type="button" id="btn-clear-fotos" class="btn btn-outline-dark btn-sm" disabled>
                                            <span class="material-symbols-outlined align-middle me-1">delete</span>Quitar todas
                                        </button>
                                    </div>
                                </div>

                                {{-- Grid de vista previa --}}
                                <div id="fotos-grid" class="row g-2"></div>
                            </div>
                        </div>
                    </div>

                    {{-- FOOTER del form: un único botón que guarda TODO --}}
                    <div class="col-12">
                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <a href="{{ route('operadores.index') }}" class="btn btn-outline-dark">Cancelar</a>
                            <button type="submit" class="btn btn-danger">
                                <span class="material-symbols-outlined me-1 align-middle">person_add</span> Guardar operador
                            </button>
                        </div>
                    </div>
                </div> {{-- /row --}}
            </form>

            {{-- FOOTER --}}
            <div class="text-center text-secondary small py-4">
                © {{ date('Y') }} Futurama Tires · Todos los derechos reservados
            </div>
        </div>
    </div>

    {{-- ===== JS: selección y previsualización de fotos ===== --}}
    <script>
        (function () {
            const MAX_FILES = 12;
            const MAX_SIZE_MB = 5;
            const MAX_SIZE = MAX_SIZE_MB * 1024 * 1024;

            const input = document.getElementById('fotos');
            const grid  = document.getElementById('fotos-grid');
            const count = document.getElementById('fotos-count');
            const btnClear = document.getElementById('btn-clear-fotos');

            let selectedFiles = [];

            function updateInputFiles() {
                const dt = new DataTransfer();
                selectedFiles.forEach(f => dt.items.add(f));
                input.files = dt.files;
                count.textContent = selectedFiles.length.toString();
                btnClear.disabled = selectedFiles.length === 0;
            }

            function renderPreviews() {
                grid.innerHTML = '';
                selectedFiles.forEach((file, idx) => {
                    const url = URL.createObjectURL(file);

                    const col = document.createElement('div');
                    col.className = 'col-6 col-md-6 col-xl-12';

                    const card = document.createElement('div');
                    card.className = 'card card-sm';

                    const img = document.createElement('img');
                    img.src = url;
                    img.alt = file.name;
                    img.className = 'card-img-top img-fluid';
                    img.onload = () => URL.revokeObjectURL(url);

                    const body = document.createElement('div');
                    body.className = 'card-body p-2';

                    const meta = document.createElement('div');
                    meta.className = 'small text-truncate mb-1';
                    meta.title = file.name;
                    meta.textContent = file.name;

                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'btn btn-outline-danger btn-sm w-100';
                    btn.innerHTML = '<span class="material-symbols-outlined align-middle me-1">delete</span>Quitar';
                    btn.addEventListener('click', () => {
                        selectedFiles.splice(idx, 1);
                        updateInputFiles();
                        renderPreviews();
                    });

                    body.appendChild(meta);
                    body.appendChild(btn);
                    card.appendChild(img);
                    card.appendChild(body);
                    col.appendChild(card);
                    grid.appendChild(col);
                });
            }

            function addFiles(files) {
                const incoming = Array.from(files || []);
                const accepted = [];

                for (const f of incoming) {
                    const typeOk = /^image\//i.test(f.type);
                    const sizeOk = f.size <= MAX_SIZE;

                    if (!typeOk || !sizeOk) continue;

                    const dup = selectedFiles.some(sf => sf.name === f.name && sf.size === f.size && sf.lastModified === f.lastModified);
                    if (dup) continue;

                    accepted.push(f);
                }

                const availableSlots = MAX_FILES - selectedFiles.length;
                if (availableSlots <= 0) return;

                selectedFiles = selectedFiles.concat(accepted.slice(0, availableSlots));
                updateInputFiles();
                renderPreviews();
            }

            input?.addEventListener('change', (e) => {
                const el = e.currentTarget;
                const files = el && el.files ? Array.from(el.files) : [];
                el.value = '';
                addFiles(files);
            });

            btnClear?.addEventListener('click', () => {
                selectedFiles = [];
                updateInputFiles();
                renderPreviews();
            });

            grid?.addEventListener('dragover', (e) => { e.preventDefault(); grid.classList.add('border', 'border-primary'); });
            grid?.addEventListener('dragleave', () => grid.classList.remove('border', 'border-primary'));
            grid?.addEventListener('drop', (e) => {
                e.preventDefault();
                grid.classList.remove('border', 'border-primary');
                addFiles(e.dataTransfer.files);
            });
        })();
    </script>

    {{-- ===== NUEVO: abrir confirmación en nueva pestaña (sin modal) ===== --}}
    @if(session('created') && session('email') && session('password'))
        <script>
            document.addEventListener('DOMContentLoaded', function(){
                try {
                    window.open(@json(route('operadores.confirmacion')), '_blank');
                } catch (e) {}
            });
        </script>
    @endif
</x-app-layout>

{{-- resources/views/operadores/edit.blade.php — campos ordenados lógicamente + fotos (clic abre en nueva pestaña) --}}
<x-app-layout>
    {{-- HEADER --}}
    <x-slot name="header">
        <div class="page-header d-print-none">
            <div class="container-xl">
                <div class="row g-2 align-items-center">
                    <div class="col">
                        <p class="text-secondary text-uppercase small mb-1">Operadores</p>
                        <h2 class="page-title mb-0">Editar un Operador</h2>
                    </div>
                    <div class="col-auto ms-auto">
                        <a href="{{ route('operadores.index') }}" class="btn btn-outline-dark">
                            <span class="material-symbols-outlined me-1 align-middle">arrow_back</span> Volver al listado
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </x-slot>

    <div class="page-body">
        <div class="container-xl">

            {{-- FLASHES --}}
            @if (session('success'))
                <div class="alert alert-success mb-4" role="alert">
                    <span class="material-symbols-outlined me-2 align-middle">check_circle</span>{{ session('success') }}
                </div>
            @endif

            @if ($errors->any())
                <div class="alert alert-danger mb-4" role="alert">
                    <span class="material-symbols-outlined me-2 align-middle">warning</span>Revisa los campos marcados y vuelve a intentar.
                    <ul class="mt-2 mb-0 ps-4">
                        @foreach ($errors->all() as $error)
                            <li class="small">{{ $error }}</li>
                        @endforeach
                    </ul>
                </div>
            @endif

            @php
                $nombreCompleto = trim(($operador->nombre ?? '').' '.($operador->apellido_paterno ?? '').' '.($operador->apellido_materno ?? ''));
                $correo = optional($operador->user)->email ?? '—';
            @endphp

            {{-- ===== FORM ÚNICO (abarca ambas columnas) ===== --}}
            <form id="operador-form" method="POST"
                  action="{{ route('operadores.update', $operador) }}"
                  enctype="multipart/form-data" novalidate>
                @csrf
                @method('PUT')

                <div class="row g-4">
                    {{-- ===== COLUMNA IZQUIERDA: DATOS ===== --}}
                    <div class="col-12 col-xl-8">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title mb-0 d-flex align-items-center gap-2">
                                    <span class="material-symbols-outlined">badge</span> Datos del operador
                                </h3>
                            </div>

                            <div class="card-body pt-3">
                                <div class="row g-4">

                                    {{-- ================= 1) IDENTIDAD ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mb-2">Identidad</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="nombre" class="form-label">Nombre <span class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">person</span></span>
                                                    <input id="nombre" name="nombre" type="text" autocomplete="given-name"
                                                           class="form-control @error('nombre') is-invalid @enderror"
                                                           value="{{ old('nombre', $operador->nombre) }}" required placeholder="Ej. Juan">
                                                    @error('nombre') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="apellido_paterno" class="form-label">Apellido paterno <span class="text-danger">*</span></label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">person</span></span>
                                                    <input id="apellido_paterno" name="apellido_paterno" type="text" autocomplete="family-name"
                                                           class="form-control @error('apellido_paterno') is-invalid @enderror"
                                                           value="{{ old('apellido_paterno', $operador->apellido_paterno) }}" required placeholder="Ej. Pérez">
                                                    @error('apellido_paterno') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="apellido_materno" class="form-label">Apellido materno</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">account_circle</span></span>
                                                    <input id="apellido_materno" name="apellido_materno" type="text" autocomplete="additional-name"
                                                           class="form-control @error('apellido_materno') is-invalid @enderror"
                                                           value="{{ old('apellido_materno', $operador->apellido_materno) }}" placeholder="(opcional)">
                                                    @error('apellido_materno') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {{-- ================= 2) CONTACTO BÁSICO ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mt-2 mb-2">Contacto básico</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="email" class="form-label">Correo electrónico</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">mail</span></span>
                                                    <input id="email" name="email" type="email" autocomplete="email"
                                                           class="form-control @error('email') is-invalid @enderror"
                                                           value="{{ old('email', optional($operador->user)->email) }}"
                                                           placeholder="usuario@dominio.com" aria-describedby="email_help">
                                                    @error('email') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                                <div id="email_help" class="form-hint">Usa un correo válido al que el operador tenga acceso.</div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="telefono" class="form-label">Teléfono (10 dígitos)</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">call</span></span>
                                                    <input id="telefono" name="telefono" type="tel"
                                                           inputmode="numeric" maxlength="10" pattern="[0-9]{10}"
                                                           oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)"
                                                           class="form-control @error('telefono') is-invalid @enderror"
                                                           value="{{ old('telefono', $operador->telefono) }}"
                                                           placeholder="Ej. 7771234567" autocomplete="tel"
                                                           title="Ingresa exactamente 10 dígitos (solo números)">
                                                    @error('telefono') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            {{-- ===== NUEVO: DOMICILIO ===== --}}
                                            <div class="col-12">
                                                <label for="domicilio" class="form-label">Domicilio</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">home_pin</span></span>
                                                    <input id="domicilio" name="domicilio" type="text"
                                                           class="form-control @error('domicilio') is-invalid @enderror"
                                                           value="{{ old('domicilio', $operador->domicilio) }}"
                                                           placeholder="Calle, número, colonia, ciudad, estado, C.P.">
                                                    @error('domicilio') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {{-- ================= 3) DATOS PERSONALES ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mt-2 mb-2">Datos personales</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="estado_civil" class="form-label">Estado civil</label>
                                                <div class="input-group">
                                                    <span class="input-group-text">
                                                        <span class="material-symbols-outlined">diversity_3</span>
                                                    </span>
                                                    <select id="estado_civil" name="estado_civil"
                                                            class="form-select @error('estado_civil') is-invalid @enderror">
                                                        <option value="">(sin especificar)</option>
                                                        @foreach(['soltero'=>'Soltero','casado'=>'Casado','viudo'=>'Viudo','divorciado'=>'Divorciado','union libre'=>'Union libre'] as $val=>$label)
                                                            <option value="{{ $val }}" {{ old('estado_civil', $operador->estado_civil)===$val ? 'selected' : '' }}>{{ $label }}</option>
                                                        @endforeach
                                                    </select>
                                                    @error('estado_civil') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="tipo_sangre" class="form-label">Tipo de sangre</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">bloodtype</span></span>
                                                    <input id="tipo_sangre" name="tipo_sangre" type="text"
                                                           class="form-control @error('tipo_sangre') is-invalid @enderror"
                                                           value="{{ old('tipo_sangre', $operador->tipo_sangre) }}"
                                                           placeholder="Ej. O+, A-, B+" maxlength="5">
                                                    @error('tipo_sangre') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                                <div class="form-hint">Formato corto (ej.: O+, A-, AB-).</div>
                                            </div>
                                        </div>
                                    </div>

                                    {{-- ================= 4) IDENTIFICADORES OFICIALES ================= --}}
                                    <div class="col-12">
                                        <div class="text-secondary text-uppercase fw-semibold small mt-2 mb-2">Identificadores oficiales</div>
                                        <div class="row g-3">
                                            <div class="col-12 col-md-6">
                                                <label for="curp" class="form-label">CURP</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">badge</span></span>
                                                    <input id="curp" name="curp" type="text"
                                                           class="form-control @error('curp') is-invalid @enderror"
                                                           value="{{ old('curp', $operador->curp) }}" maxlength="18"
                                                           style="text-transform:uppercase"
                                                           oninput="this.value=this.value.toUpperCase().replace(/\s+/g,'');"
                                                           pattern="[A-ZÑ0-9]{18}"
                                                           title="18 caracteres en mayúsculas (A-Z/Ñ/0-9)">
                                                    @error('curp') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>

                                            <div class="col-12 col-md-6">
                                                <label for="rfc" class="form-label">RFC</label>
                                                <div class="input-group">
                                                    <span class="input-group-text"><span class="material-symbols-outlined">verified</span></span>
                                                    <input id="rfc" name="rfc" type="text"
                                                           class="form-control @error('rfc') is-invalid @enderror"
                                                           value="{{ old('rfc', $operador->rfc) }}" maxlength="13"
                                                           style="text-transform:uppercase"
                                                           oninput="this.value=this.value.toUpperCase().replace(/\s+/g,'');"
                                                           pattern="([A-ZÑ&]{3,4})\d{6}[A-Z0-9]{3}"
                                                           title="3-4 letras + 6 dígitos de fecha + 3 alfanum.">
                                                    @error('rfc') <div class="invalid-feedback">{{ $message }}</div> @enderror
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {{-- ================= 5) CONTACTO DE EMERGENCIA ================= --}}
                                    <div class="col-12">
        <div class="text-secondary text-uppercase fw-semibold small mt-2 mb-2">Contacto de emergencia</div>
        <div class="row g-3">
            <div class="col-12 col-md-6">
                <label for="contacto_emergencia_nombre" class="form-label">Nombre</label>
                <div class="input-group">
                    <span class="input-group-text"><span class="material-symbols-outlined">contact_emergency</span></span>
                    <input id="contacto_emergencia_nombre" name="contacto_emergencia_nombre" type="text"
                           class="form-control @error('contacto_emergencia_nombre') is-invalid @enderror"
                           value="{{ old('contacto_emergencia_nombre', $operador->contacto_emergencia_nombre) }}"
                           placeholder="Ej. Juan Pérez">
                    @error('contacto_emergencia_nombre') <div class="invalid-feedback">{{ $message }}</div> @enderror
                </div>
            </div>

            <div class="col-12 col-md-6">
                <label for="contacto_emergencia_parentesco" class="form-label">Parentesco</label>
                <div class="input-group">
                    <span class="input-group-text"><span class="material-symbols-outlined">diversity_1</span></span>
                    <input id="contacto_emergencia_parentesco" name="contacto_emergencia_parentesco" type="text"
                           class="form-control @error('contacto_emergencia_parentesco') is-invalid @enderror"
                           value="{{ old('contacto_emergencia_parentesco', $operador->contacto_emergencia_parentesco) }}" placeholder="Ej. Esposa, Hermano, Amigo">
                    @error('contacto_emergencia_parentesco') <div class="invalid-feedback">{{ $message }}</div> @enderror
                </div>
            </div>

            <div class="col-12 col-md-6">
                <label for="contacto_emergencia_tel" class="form-label">Teléfono de emergencia (10 dígitos)</label>
                <div class="input-group">
                    <span class="input-group-text"><span class="material-symbols-outlined">call</span></span>
                    <input id="contacto_emergencia_tel" name="contacto_emergencia_tel" type="tel"
                           inputmode="numeric" maxlength="10" pattern="[0-9]{10}"
                           oninput="this.value=this.value.replace(/\D/g,'').slice(0,10)"
                           class="form-control @error('contacto_emergencia_tel') is-invalid @enderror"
                           value="{{ old('contacto_emergencia_tel', $operador->contacto_emergencia_tel) }}"
                           placeholder="Ej. 7770000000"
                           title="Ingresa exactamente 10 dígitos (solo números)">
                    @error('contacto_emergencia_tel') <div class="invalid-feedback">{{ $message }}</div> @enderror
                </div>
            </div>

            <div class="col-12 col-md-6">
                <label for="contacto_emergencia_ubicacion" class="form-label">Ubicación</label>
                <div class="input-group">
                    <span class="input-group-text"><span class="material-symbols-outlined">place</span></span>
                    <input id="contacto_emergencia_ubicacion" name="contacto_emergencia_ubicacion" type="text"
                           class="form-control @error('contacto_emergencia_ubicacion') is-invalid @enderror"
                           value="{{ old('contacto_emergencia_ubicacion', $operador->contacto_emergencia_ubicacion) }}" placeholder="Ej. Cuernavaca, Morelos">
                    @error('contacto_emergencia_ubicacion') <div class="invalid-feedback">{{ $message }}</div> @enderror
                </div>
            </div>
        </div>
    </div>

                                </div> {{-- /row --}}
                            </div>
                        </div>
                    </div>

                    {{-- ===== COLUMNA DERECHA: AVATAR + FOTOS ===== --}}
                    <div class="col-12 col-xl-4">

                        {{-- FOTOS: subir + marcado borrar + lista (clic abre en nueva pestaña) --}}
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title mb-0 d-flex align-items-center">
                                    <span class="material-symbols-outlined me-2">add_photo_alternate</span>
                                    Agregar fotografías
                                </h3>
                            </div>

                            {{-- Subir nuevas --}}
                            <div class="card-body">
                                <div class="form-hint mb-3">Máx 8&nbsp;MB por archivo.</div>

                                <div class="row g-3 align-items-end">
                                    <div class="col-12">
                                        <div class="input-group">
                                            <span class="input-group-text"><span class="material-symbols-outlined">upload</span></span>
                                            <input type="file" name="fotos[]" accept="image/*" multiple
                                                   class="form-control @error('fotos') is-invalid @enderror @error('fotos.*') is-invalid @enderror">
                                        </div>
                                        @error('fotos')   <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                                        @error('fotos.*') <div class="invalid-feedback d-block">{{ $message }}</div> @enderror
                                    </div>
                                </div>
                            </div>

                            {{-- Listado/galería simple y marcado para borrar --}}
                            <div class="card-body border-top">
                                <div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
                                    <div class="d-flex align-items-center gap-2">
                                        <h2 class="h5 mb-0 d-flex align-items-center">
                                            <span class="material-symbols-outlined me-2">photo</span>
                                            Fotografías actuales
                                        </h2>
                                        <span class="badge bg-secondary-lt">{{ $operador->fotos->count() }} foto(s)</span>
                                    </div>
                                    <div class="d-flex align-items-center gap-3">
                                        <span class="small text-secondary">
                                            Marcadas: <strong id="delCount">0</strong>
                                        </span>
                                    </div>
                                </div>

                                @if($operador->fotos->isEmpty())
                                    <div class="empty my-4">
                                        <div class="empty-icon">
                                            <span class="material-symbols-outlined">image_not_supported</span>
                                        </div>
                                        <p class="empty-title">Este operador aún no tiene fotos</p>
                                    </div>
                                @else
                                    <div class="row g-3" id="photosGrid">
                                        @foreach($operador->fotos as $foto)
                                            <div class="col-12">
                                                <div class="card position-relative foto-card" data-id="{{ $foto->id }}">
                                                    <div class="ratio ratio-4x3">
                                                        <a href="{{ route('operadores.fotos.show', $foto) }}"
                                                           target="_blank" rel="noopener noreferrer"
                                                           title="Abrir en nueva pestaña"
                                                           class="stretched-link"></a>
                                                        <img src="{{ route('operadores.fotos.show', $foto) }}"
                                                             alt="Foto {{ $loop->iteration }} de {{ $nombreCompleto ?: ('Operador #'.$operador->id) }}"
                                                             class="w-100 h-100 rounded object-fit-cover">
                                                    </div>

                                                    <button type="button"
                                                            class="btn btn-danger btn-icon btn-sm position-absolute top-0 end-0 m-1 toggle-delete z-3"
                                                            data-id="{{ $foto->id }}" title="Marcar para borrar">
                                                        <span class="material-symbols-outlined">delete</span>
                                                    </button>

                                                    <input type="checkbox" class="d-none delete-input"
                                                           id="del-{{ $foto->id }}" name="delete_fotos[]" value="{{ $foto->id }}">

                                                    <div class="position-absolute top-0 start-0 w-100 h-100 rounded bg-danger opacity-25 d-none overlay-del"></div>
                                                    <span class="badge bg-danger position-absolute bottom-0 start-0 m-2 d-none badge-del">
                                                        <span class="material-symbols-outlined me-1 align-middle">delete</span> Se borrará
                                                    </span>
                                                </div>
                                            </div>
                                        @endforeach
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>

                    {{-- FOOTER del form: un único botón que guarda TODO --}}
                    <div class="col-12">
                        <div class="d-flex justify-content-end gap-2 mt-4">
                            <a href="{{ route('operadores.index') }}" class="btn btn-outline-dark">Cancelar</a>
                            <button type="submit" class="btn btn-danger">
                                <span class="material-symbols-outlined me-1 align-middle">save</span> Guardar todo
                            </button>
                        </div>
                    </div>
                </div> {{-- /row --}}
            </form>

            {{-- ===== LICENCIAS DEL OPERADOR ===== --}}
            <div class="card mt-4">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h3 class="card-title mb-0 d-flex align-items-center gap-2">
                        <span class="material-symbols-outlined">badge</span> Licencias de conducir
                    </h3>
                    <div>
                        <a href="{{ route('licencias.create', ['operador_id' => $operador->id]) }}"
                           class="btn btn-outline-danger btn-sm">
                            <span class="material-symbols-outlined me-1 align-middle">add</span>Agregar licencia
                        </a>
                    </div>
                </div>

                <div class="card-body p-0">
                    @php $lics = $operador->licencias()->with('archivos')->orderByDesc('fecha_vencimiento')->get(); @endphp

                    @if($lics->isEmpty())
                        <div class="p-4 text-secondary">Este operador no tiene licencias registradas.</div>
                    @else
                        <div class="table-responsive">
                            <table class="table table-vcenter table-striped table-hover mb-0">
                                <thead>
                                    <tr class="text-uppercase text-secondary small">
                                        <th>Ámbito</th>
                                        <th>Tipo</th>
                                        <th>Folio</th>
                                        <th>Expedición</th>
                                        <th>Vencimiento</th>
                                        <th>Estatus</th>
                                        <th>Archivos</th>
                                        <th class="text-end">Acciones</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach($lics as $l)
                                        @php $status = $l->estatus; @endphp
                                        <tr>
                                            <td class="text-capitalize">{{ $l->ambito ?: '—' }}</td>
                                            <td>{{ $l->tipo ?: '—' }}</td>
                                            <td>{{ $l->folio ?: '—' }}</td>
                                            <td>{{ optional($l->fecha_expedicion)->format('Y-m-d') ?: '—' }}</td>
                                            <td>{{ optional($l->fecha_vencimiento)->format('Y-m-d') ?: '—' }}</td>
                                            <td>
                                                @if($status==='vigente')
                                                    <span class="badge bg-success">Vigente</span>
                                                @elseif($status==='por_vencer')
                                                    <span class="badge bg-warning text-dark">Por vencer</span>
                                                @elseif($status==='vencida')
                                                    <span class="badge bg-danger">Vencida</span>
                                                @else
                                                    <span class="badge bg-secondary">N/D</span>
                                                @endif
                                            </td>
                                            <td>
                                                @if($l->archivos->isEmpty())
                                                    <span class="text-secondary">0</span>
                                                @else
                                                    <div class="d-flex gap-1 flex-wrap">
                                                        @foreach($l->archivos as $a)
                                                            <a href="{{ route('licencias.archivos.inline', $a) }}" class="btn btn-outline-dark btn-xs" target="_blank" rel="noopener" title="{{ $a->nombre_original }}">
                                                                <span class="material-symbols-outlined" style="font-size:18px;">visibility</span>
                                                            </a>
                                                        @endforeach
                                                    </div>
                                                @endif
                                            </td>
                                            <td class="text-end">
                                                <a href="{{ route('licencias.edit', $l) }}" class="btn btn-outline-dark btn-sm">
                                                    <span class="material-symbols-outlined me-1 align-middle">edit</span>Editar
                                                </a>
                                                <form action="{{ route('licencias.destroy', $l) }}" method="POST" class="d-inline"
                                                      onsubmit="return confirm('¿Eliminar la licencia seleccionada? Esta acción borrará sus archivos.');">
                                                    @csrf @method('DELETE')
                                                    <button class="btn btn-outline-danger btn-sm">
                                                        <span class="material-symbols-outlined me-1 align-middle">delete</span>Eliminar
                                                    </button>
                                                </form>
                                            </td>
                                        </tr>
                                    @endforeach
                                </tbody>
                            </table>
                        </div>
                    @endif
                </div>
            </div>

            {{-- FOOTER --}}
            <div class="text-center text-secondary small py-4">
                © {{ date('Y') }} Futurama Tires · Todos los derechos reservados
            </div>
        </div>
    </div>

    {{-- ===== SCRIPTS ===== --}}
    <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Togglear borrado de fotos ---
        const delCountEl = document.getElementById('delCount');
        function refreshDelCount(){
            const checked = document.querySelectorAll('.delete-input:checked').length;
            if (delCountEl) delCountEl.textContent = String(checked);
        }

        document.getElementById('photosGrid')?.querySelectorAll('.toggle-delete').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                e.stopPropagation();

                const id = btn.getAttribute('data-id');
                const input = document.getElementById('del-' + id);
                const card  = btn.closest('.foto-card');
                const overlay = card?.querySelector('.overlay-del');
                const badge   = card?.querySelector('.badge-del');

                if (!input) return;
                input.checked = !input.checked;

                const marked = input.checked;
                btn.classList.toggle('btn-danger', !marked);
                btn.classList.toggle('btn-warning', marked);
                if (overlay) overlay.classList.toggle('d-none', !marked);
                if (badge)   badge.classList.toggle('d-none', !marked);
                btn.title = marked ? 'Quitar de borrado' : 'Marcar para borrar';

                refreshDelCount();
            });
        });

        refreshDelCount();
    });
    </script>

    <style>
        .bg-cover { background-repeat: no-repeat; }
        .overlay-del { pointer-events: none; }
        .foto-card .toggle-delete { z-index: 3; }
        .object-fit-cover { object-fit: cover; }
    </style>
</x-app-layout>
